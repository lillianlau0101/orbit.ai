# PRD：orbit.ai 多轮 AI 心理对话功能（零 key MVP）

## 概述  
在 orbit.ai 提供零成本、多轮、沉浸式心理 AI 对话，首期基于微信混元-pro（1 亿 token/月免费），后续可无缝切换 Kimi/DeepSeek。

## 目标  
- 3 日内完成 MVP：文字+语音 → AI 回复 → 本地历史  
- 7 日留存 ≥ +10%（We 分析 `day7Retention`）  
- 人均对话轮次 ≥ 3/日（埋点 `chat_round`）

## 用户故事

### US-001：发送文字并接收 AI 回复  
**作为**用户，**我想**输入文字并立即收到温柔回复，**以便**被倾听。  
**验收：**  
- [ ] 输入框 ≤200 字，点击「发送」调 `chatMulti`  
- [ ] 回复 ≤75 字，气泡展示，加载 ≤1.5 s  
- [ ] 网络失败可重试，错误打印 Console  
- [ ] Typecheck 通过  
- [ ] **使用 dev-browser 技能在浏览器验证**气泡与加载态  

### US-002：语音转文字输入  
**作为**用户，**我想**用语音快速记录心情，**以便**解放双手。  
**验收：**  
- [ ] 长按语音 ≤60 s，微信同声传写插件自动转文字  
- [ ] 转写成功率 ≥90%（普通话），失败可手动修改  
- [ ] 转写完成自动触发 US-001 流程  
- [ ] Typecheck 通过  
- [ ] **使用 dev-browser 技能在浏览器验证**转写 loading & 结果气泡  

### US-003：本地历史会话列表  
**作为**用户，**我想**查看今天所有对话，**以便**回顾情绪。  
**验收：**  
- [ ] 进入页面自动拉取当日 `chat` 集合（`_openid` + 日期）  
- [ ] 倒序展示：用户气泡 + AI 气泡 + 时间戳  
- [ ] 空状态提示「今天还没对话，说点什么吧」  
- [ ] Typecheck 通过  
- [ ] **使用 dev-browser 技能在浏览器验证**空状态与卡片间距  

### US-004：情绪 5 星标记  
**作为**用户，**我想**给每次对话标情绪，**以便**以后看趋势。  
**验收：**  
- [ ] 发送后弹出 5 星评分（默认 3 星），可跳过  
- [ ] 评分写入 `chat` 文档 `mood: 1-5`  
- [ ] 日后可一键关闭（写入用户配置）  
- [ ] Typecheck 通过  
- [ ] **使用 dev-browser 技能在浏览器验证**星星点击态与跳过按钮  

## 功能需求  
FR-1：云函数 `chatMulti` 接受 `{text, mood}` 返回 `{reply, ts}`  
FR-2：前端 `wx.cloud.callFunction` 名=`chatMulti`，超时 ≤5 s  
FR-3：语音云函数 `transcribeVoice` 返回 `{text, duration}`，免费额度  
FR-4：DB 集合 `chat` 字段：`_openid`, `text`, `reply`, `mood`, `ts`, `date`  
FR-5：历史列表自动滚动到底部（新消息可见）  
FR-6：所有网络失败显示 Toast + 重试按钮，不重试不埋点  

## 非目标  
- 多设备同步、后台推送、报表、社交、登录注册  

## 设计考虑  
- 复用气泡组件：用户右、AI 左，配色 #faf7f2 / #fff  
- 底部固定输入栏，语音+文字双入口（微信风格）  
- 加载骨架气泡 40 rpx  
- 空状态插画：`assets/empty-chat.svg`  

## 技术考虑  
- 混元-pro 免费 1 亿 token/月，换模型=改云函数 endpoint  
- 语音：微信同声传写插件，2000 分钟/月免费  
- 历史 90 天自动清理（定时触发器）  
- 云函数统一 Nodejs 18，256 M，5 s 超时  

## 成功指标  
- 对话成功率 ≥ 98%（云函数错误 &lt;2%）  
- 首句响应 ≤ 1.5 s（混元-pro 实测 0.8 s）  
- 语音转写准确率 ≥ 90%（普通话）  
- 7 日留存 ≥ +10%  

## 待澄清问题  
- MVP 是否支持英文语音转写？  
- 情绪折线视图是否第二迭代？  
- 是否接入微信订阅消息提醒用户回来说话？  

---

✅ **Checklist**  
- [x] 提出字母选项澄清问题  
- [x] 用户故事含验收标准 & dev-browser 验证  
- [x] 功能需求编号、无歧义  
- [x] 非目标明确  
- [x] 已保存至 `tasks/prd-orbit-ai.md`  

**Next：**按 US-001 → US-004 顺序实现，推 `main` 并截图验收每一步。
